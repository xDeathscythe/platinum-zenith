import{j as e}from"./vendor-motion-C-S6sOG7.js";import{r as t,v as n}from"./vendor-react-HserkeQh.js";import{J as r,G as o,aj as a,w as i,k as c,as as s}from"./index-S7FKDcGU-BFqPyMS1.js";import"./index-DXp2A_ku.js";const u=c(s());function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){d(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&(typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(s){c=!0,o=s}finally{try{!i&&null!=n.return&&n.return()}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v=function(e){var t=n.useRef(e);return n.useEffect(function(){t.current=e},[e]),t.current},b=function(e){return null!==e&&"object"===f(e)},g="[object Object]",h=function e(t,n){if(!b(t)||!b(n))return t===n;var r=Array.isArray(t);if(r!==Array.isArray(n))return!1;var o=Object.prototype.toString.call(t)===g;if(o!==(Object.prototype.toString.call(n)===g))return!1;if(!o&&!r)return t===n;var a=Object.keys(t),i=Object.keys(n);if(a.length!==i.length)return!1;for(var c={},s=0;s<a.length;s+=1)c[a[s]]=!0;for(var u=0;u<i.length;u+=1)c[i[u]]=!0;var l=Object.keys(c);if(l.length!==a.length)return!1;var p=t,f=n;return l.every(function(t){return e(p[t],f[t])})},j=function(e,t,n){return b(e)?Object.keys(e).reduce(function(r,o){var a=!b(t)||!h(e[o],t[o]);return n.includes(o)?r:a?p(p({},r||{}),{},d({},o,e[o])):r},null):null},S=function(e){if(null===e||function(e){return b(e)&&"function"==typeof e.elements&&"function"==typeof e.createToken&&"function"==typeof e.createPaymentMethod&&"function"==typeof e.confirmCardPayment}(e))return e;throw new Error("Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.")},w=function(e){if(function(e){return b(e)&&"function"==typeof e.then}(e))return{tag:"async",stripePromise:Promise.resolve(e).then(S)};var t=S(e);return null===t?{tag:"empty"}:{tag:"sync",stripe:t}},E=n.createContext(null);E.displayName="ElementsContext";var O=function(e){var t=e.stripe,r=e.options,o=e.children,a=n.useMemo(function(){return w(t)},[t]),i=m(n.useState(function(){return{stripe:"sync"===a.tag?a.stripe:null,elements:"sync"===a.tag?a.stripe.elements(r):null}}),2),c=i[0],s=i[1];n.useEffect(function(){var e=!0,t=function(e){s(function(t){return t.stripe?t:{stripe:e,elements:e.elements(r)}})};return"async"!==a.tag||c.stripe?"sync"===a.tag&&!c.stripe&&t(a.stripe):a.stripePromise.then(function(n){n&&e&&t(n)}),function(){e=!1}},[a,c,r]);var u=v(t);n.useEffect(function(){},[u,t]);var l=v(r);return n.useEffect(function(){if(c.elements){var e=j(r,l,["clientSecret","fonts"]);e&&c.elements.update(e)}},[r,l,c.elements]),n.useEffect(function(){var e=c.stripe;!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"1.10.0"}),e.registerAppInfo({name:"react-stripe-js",version:"1.10.0",url:"https://stripe.com/docs/stripe-js/react"}))},[c.stripe]),n.createElement(E.Provider,{value:c},o)};O.propTypes={stripe:u.any,options:u.object};var _=function(e){return function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e}(n.useContext(E),e)};u.func.isRequired;var x=function(e){var t=n.useRef(e);return n.useEffect(function(){t.current=e},[e]),function(){t.current&&t.current.apply(t,arguments)}},P=function(){},k=function(e,t){var r="".concat(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(e),"Element"),o=t?function(e){_("mounts <".concat(r,">"));var t=e.id,o=e.className;return n.createElement("div",{id:t,className:o})}:function(t){var o=t.id,a=t.className,i=t.options,c=void 0===i?{}:i,s=t.onBlur,u=void 0===s?P:s,l=t.onFocus,p=void 0===l?P:l,f=t.onReady,d=void 0===f?P:f,m=t.onChange,y=void 0===m?P:m,b=t.onEscape,g=void 0===b?P:b,h=t.onClick,S=void 0===h?P:h,w=t.onLoadError,E=void 0===w?P:w,O=t.onLoaderStart,k=void 0===O?P:O,C=_("mounts <".concat(r,">")).elements,I=n.useRef(null),A=n.useRef(null),N=x(d),L=x(u),B=x(p),D=x(S),R=x(y),F=x(g),T=x(E),q=x(k);n.useLayoutEffect(function(){if(null==I.current&&C&&null!=A.current){var t=C.create(e,c);I.current=t,t.mount(A.current),t.on("ready",function(){return N(t)}),t.on("change",R),t.on("blur",L),t.on("focus",B),t.on("escape",F),t.on("loaderror",T),t.on("loaderstart",q),t.on("click",D)}});var M=v(c);return n.useEffect(function(){if(I.current){var e=j(c,M,["paymentRequest"]);e&&I.current.update(e)}},[c,M]),n.useLayoutEffect(function(){return function(){I.current&&(I.current.destroy(),I.current=null)}},[]),n.createElement("div",{id:o,className:a,ref:A})};return o.propTypes={id:u.string,className:u.string,onChange:u.func,onBlur:u.func,onFocus:u.func,onReady:u.func,onClick:u.func,onLoadError:u.func,onLoaderStart:u.func,options:u.object},o.displayName=r,o.__elementType=e,o},C=typeof window>"u";k("auBankAccount",C),k("card",C),k("cardNumber",C),k("cardExpiry",C),k("cardCvc",C),k("fpxBank",C),k("iban",C),k("idealBank",C),k("p24Bank",C),k("epsBank",C);var I=k("payment",C);k("paymentRequestButton",C),k("linkAuthentication",C),k("shippingAddress",C),k("affirmMessage",C),k("afterpayClearpayMessage",C);var A,N,L,B={};function D(){if(A)return B;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}A=1,Object.defineProperty(B,"__esModule",{value:!0});var t,n="https://js.stripe.com/v3",r=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,o=null,a=function(e){return null!==o||(o=new Promise(function(t,o){if(typeof window>"u")t(null);else if(window.Stripe,window.Stripe)t(window.Stripe);else try{var a=function(){for(var e=document.querySelectorAll('script[src^="'.concat(n,'"]')),t=0;t<e.length;t++){var o=e[t];if(r.test(o.src))return o}return null}();a&&e||(a||(a=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(n).concat(t);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(r),r}(e))),a.addEventListener("load",function(){window.Stripe?t(window.Stripe):o(new Error("Stripe.js not available"))}),a.addEventListener("error",function(){o(new Error("Failed to load Stripe.js"))})}catch(i){return void o(i)}})),o},i=!1,c=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];i=!0;var o=Date.now();return a(t).then(function(e){return function(e,t,n){if(null===e)return null;var r=e.apply(void 0,t);return function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"1.35.0",startTime:t})}(r,n),r}(e,n,o)})};return c.setLoadParameters=function(n){if(i)throw new Error("You cannot change load parameters after calling loadStripe");t=function(t){var n="invalid load parameters; expected object of shape\n\n    {advancedFraudSignals: boolean}\n\nbut received\n\n    ".concat(JSON.stringify(t),"\n");if(null===t||"object"!==e(t))throw new Error(n);if(1===Object.keys(t).length&&"boolean"==typeof t.advancedFraudSignals)return t;throw new Error(n)}(n)},B.loadStripe=c,B}var R=(L||(L=1,N=D()),N);const F={}.NEXT_PUBLIC_STRIPE_PUBLIC_KEY||"";let T;const q=n=>{const{t:o,i18n:c}=r(),{paymentOption:s,elements:u,state:l,onPaymentElementChange:p}=n,[f,d]=t.useState(!1),[m,y]=t.useState("HOLD"!==s),v=f||!m||["processing","error"].includes(l.status);return t.useEffect(()=>{null==u||u.update({locale:c.language})},[u,c.language]),e.jsxs("form",{id:"payment-form",className:"bg-subtle mt-4 rounded-md p-6",onSubmit:n.onSubmit,children:[e.jsx("div",{children:e.jsx(I,{options:{layout:"accordion"},onChange:e=>p()})}),"HOLD"===s&&e.jsx("div",{className:"bg-cal-info mb-5 mt-2 rounded-md p-3",children:e.jsx(a,{description:o("acknowledge_booking_no_show_fee",{amount:n.payment.amount/100,formatParams:{amount:{currency:n.payment.currency}}}),onChange:e=>y(e.target.checked),descriptionClassName:"text-info font-semibold"})}),e.jsxs("div",{className:"mt-2 flex justify-end space-x-2",children:[e.jsx(i,{color:"minimal",disabled:v,id:"cancel",type:"button",loading:f,onClick:()=>{d(!0),n.onCancel()},children:e.jsx("span",{id:"button-text",children:o("cancel")})}),e.jsx(i,{type:"submit",disabled:v,loading:"processing"===l.status,id:"submit",color:"secondary",children:e.jsx("span",{id:"button-text",children:"processing"===l.status?e.jsx("div",{className:"spinner",id:"spinner"}):o("HOLD"===s?"submit_card":"pay_now")})})]}),"error"===l.status&&e.jsx("div",{className:"mt-4 text-center text-red-900 dark:text-gray-300",role:"alert",children:l.error.message})]})},M=n=>{const{t:a}=r(),i=_("calls useElements()").elements,c=n.payment.paymentOption;n.booking.attendees[0].email;const s=_("calls useStripe()").stripe,[u,l]=t.useState({status:"idle"});return e.jsx(q,{...n,elements:i,paymentOption:c,state:u,onSubmit:async e=>{var t;if(e.preventDefault(),!s||!i)return;let r;l({status:"processing"});const u={uid:n.booking.uid};"HOLD"===c&&"setupIntent"in n.payment.data?(r=await s.confirmSetup({elements:i,redirect:"if_required"}),r.setupIntent&&(u.payment_intent=r.setupIntent.id,u.payment_intent_client_secret=r.setupIntent.client_secret||void 0,u.redirect_status=r.setupIntent.status)):"ON_BOOKING"===c&&(r=await s.confirmPayment({elements:i,redirect:"if_required",confirmParams:{return_url:`${o}/booking/${u.uid}`}}),r.paymentIntent&&(u.payment_intent=r.paymentIntent.id,u.payment_intent_client_secret=r.paymentIntent.client_secret||void 0,u.redirect_status=r.paymentIntent.status)),null!=r&&r.error?l({status:"error",error:new Error(`Payment failed: ${r.error.message}`)}):(l({status:"idle"}),null==(t=n.onPaymentSuccess)||t.call(n,n),n.location&&(n.location.includes("integration")?u.location=a("web_conferencing_details_to_follow"):u.location=n.location))},onCancel:()=>{var e;null==(e=n.onPaymentCancellation)||e.call(n,n)},onPaymentElementChange:()=>{l({status:"idle"})}})},U=n=>{const r=(e=>(T||(T=R.loadStripe(e||F)),T))(n.payment.data.stripe_publishable_key),[o,a]=t.useState("stripe");return t.useEffect(()=>{document.documentElement.classList.contains("dark")&&a("night")},[]),e.jsx(O,{stripe:r,options:{clientSecret:n.clientSecret,appearance:{theme:o}},children:e.jsx(M,{...n})})};export{U as default};
