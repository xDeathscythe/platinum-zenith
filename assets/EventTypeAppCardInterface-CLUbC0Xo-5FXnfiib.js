import{j as e}from"./vendor-motion-C-S6sOG7.js";import{o as l,p as a,a6 as s,J as n,G as i,I as t,z as o,a1 as c,w as d,s as r,a7 as u,a0 as m,C as v,a8 as x,a9 as h,aa as f,ab as j}from"./index-S7FKDcGU-CcwJBnip.js";import{r as b}from"./vendor-react-HserkeQh.js";import{Z as p,h as C}from"./AppCard-CQEg94Y3-YqsoCIHS.js";import{f as _}from"./useIsAppEnabled-DnQeiNdg-cvPTXuph.js";import"./index-W_TQsZEV.js";const N=({fieldRules:l,updateFieldRules:a})=>{const{t:s}=n(),i=[{label:s("salesforce_rr_skip_field_rule_ignore"),value:j.IGNORE},{label:s("salesforce_rr_skip_field_rule_must_include"),value:j.MUST_INCLUDE}],[o,r]=b.useState({field:"",value:"",action:j.IGNORE}),[u,m]=b.useState(null),[v,x]=b.useState(null),h=()=>{m(null),x(null)};return e.jsxs(C.SubSection,{children:[e.jsx(C.SubSectionHeader,{icon:"filter",title:s("salesforce_rr_skip_field_rules"),labelFor:"rr-skip-field-rules",children:e.jsx(e.Fragment,{})}),e.jsxs(C.SubSectionContent,{children:[e.jsxs("div",{className:"text-subtle flex gap-3 px-3 py-[6px] text-sm font-medium",children:[e.jsx("div",{className:"flex-1",children:s("field_name")}),e.jsx("div",{className:"flex-1",children:s("value")}),e.jsx("div",{className:"w-32",children:s("action")}),e.jsx("div",{className:"w-20"})]}),e.jsxs(C.SubSectionNested,{children:[l.map((s,n)=>{const o=u===n;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:o?e.jsx(c,{value:(null==v?void 0:v.field)||"",onChange:e=>x(l=>l?{...l,field:e.target.value}:null),size:"sm",className:"w-full"}):e.jsx(c,{value:s.field,readOnly:!0,size:"sm",className:"w-full"})}),e.jsx("div",{className:"flex-1",children:o?e.jsx(c,{value:(null==v?void 0:v.value)||"",onChange:e=>x(l=>l?{...l,value:e.target.value}:null),size:"sm",className:"w-full"}):e.jsx(c,{value:s.value,readOnly:!0,size:"sm",className:"w-full"})}),e.jsx("div",{className:"w-32",children:o?e.jsx(t,{size:"sm",className:"w-full",options:i,value:i.find(e=>e.value===(null==v?void 0:v.action)),onChange:e=>{e&&x(l=>l?{...l,action:e.value}:null)}}):e.jsx(t,{size:"sm",className:"w-full",options:i,value:i.find(e=>e.value===s.action),isDisabled:!0})}),e.jsx("div",{className:"flex w-20 justify-center gap-1",children:o?e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",StartIcon:"check",variant:"icon",color:"primary",onClick:()=>(()=>{if(null===u||!v||!v.field.trim()||!v.value.trim())return;const e=[...l];e[u]={field:v.field.trim(),value:v.value.trim(),action:v.action},a(e),h()})()}),e.jsx(d,{size:"sm",StartIcon:"x",variant:"icon",color:"secondary",onClick:()=>h()})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",StartIcon:"pencil",variant:"icon",color:"minimal",onClick:()=>(e=>{const a=l[e];m(e),x({field:a.field,value:a.value,action:a.action})})(n)}),e.jsx(d,{StartIcon:"x",variant:"icon",size:"sm",color:"minimal",onClick:()=>{a(l.filter((e,l)=>l!==n))}})]})})]},`${s.field}-${n}`)}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(c,{size:"sm",className:"w-full",placeholder:s("salesforce_field_name_placeholder"),value:o.field,onChange:e=>r({...o,field:e.target.value})})}),e.jsx("div",{className:"flex-1",children:e.jsx(c,{size:"sm",className:"w-full",placeholder:s("value"),value:o.value,onChange:e=>r({...o,value:e.target.value})})}),e.jsx("div",{className:"w-32",children:e.jsx(t,{size:"sm",className:"w-full",options:i,value:i.find(e=>e.value===o.action),onChange:e=>{e&&r({...o,action:e.value})}})}),e.jsx("div",{className:"w-20"})]})]}),e.jsx(d,{className:"text-subtle mt-2 w-fit",StartIcon:"plus",color:"minimal",size:"sm",disabled:!(o.field&&o.value),onClick:()=>{a([...l,{field:o.field.trim(),value:o.value.trim(),action:o.action}]),r({field:"",value:"",action:j.IGNORE})},children:s("add_new_rule")})]})]})};var g=(e=>(e.ON_BOOKING="on_booking",e.ON_CANCEL="on_cancel",e))(g||{});const S=({bookingAction:l,optionLabel:a,optionEnabled:s,optionSwitchOnChange:i,writeToObjectData:u,updateWriteToObjectData:m})=>{const{t:v}=n(),j=[{label:v("text"),value:x.TEXT},{label:v("date"),value:x.DATE},{label:v("phone").charAt(0).toUpperCase()+v("phone").slice(1),value:x.PHONE},{label:v("checkbox"),value:x.CHECKBOX},{label:v("picklist"),value:x.PICKLIST},{label:v("custom"),value:x.CUSTOM}],p=[{label:v("only_if_field_is_empty"),value:h.FIELD_EMPTY},..."on_cancel"===l?[{label:v("salesforce_on_every_cancellation"),value:h.EVERY_BOOKING}]:[{label:v("on_every_booking"),value:h.EVERY_BOOKING}]],_=[{label:v("true"),value:!0},{label:v("false"),value:!1}],N=[..."on_cancel"===l?[{label:v("booking_cancel_date"),value:f.BOOKING_CANCEL_DATE}]:[],{label:v("booking_start_date"),value:f.BOOKING_START_DATE},{label:v("booking_created_date"),value:f.BOOKING_CREATED_DATE}],[g,S]=b.useState(j[0]),[k,w]=b.useState(N[0]),[T,O]=b.useState(_[0]),[z,y]=b.useState(p[0]),[E,F]=b.useState({}),[A,D]=b.useState({}),[R,I]=b.useState({field:"",fieldType:g.value,value:"",whenToWrite:z.value}),W=e=>{F(l=>({...l,[e]:!1})),D(l=>{const a={...l};return delete a[e],a})};return e.jsxs(e.Fragment,{children:[e.jsx(C.SubSectionHeader,{icon:"star",labelFor:"write-to-object-settings",title:a,children:e.jsx(o,{checked:s,onCheckedChange:i,id:"write-to-object-settings",size:"sm"})}),s?e.jsxs(C.SubSectionContent,{children:[e.jsxs("div",{className:"text-subtle flex gap-3 px-3 py-[6px] text-sm font-medium",children:[e.jsx("div",{className:"flex-1",children:v("field_name")}),e.jsx("div",{className:"flex-1",children:v("field_type")}),e.jsx("div",{className:"flex-1",children:v("value")}),e.jsx("div",{className:"flex-1",children:v("when_to_write")}),e.jsx("div",{className:"w-20"})]}),e.jsxs(C.SubSectionNested,{children:[Object.keys(u).map(l=>{const a=E[l],s=A[l];return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:a?e.jsx(c,{value:(null==s?void 0:s.field)||l,onChange:e=>D(a=>({...a,[l]:{...s,field:e.target.value}})),size:"sm",className:"w-full"}):e.jsx(c,{value:l,readOnly:!0,size:"sm",className:"w-full"})}),e.jsx("div",{className:"flex-1",children:a?e.jsx(t,{size:"sm",className:"w-full",options:j,value:j.find(e=>e.value===(null==s?void 0:s.fieldType)),onChange:e=>{e&&D(a=>({...a,[l]:{...s,fieldType:e.value,...e.value===x.DATE&&{value:N[0].value},...e.value===x.CHECKBOX&&{value:_[0].value}}}))}}):e.jsx(t,{size:"sm",className:"w-full",value:j.find(e=>e.value===u[l].fieldType),isDisabled:!0})}),e.jsx("div",{className:"flex-1",children:a?(null==s?void 0:s.fieldType)===x.DATE?e.jsx(t,{size:"sm",className:"w-full",options:N,value:N.find(e=>e.value===s.value),onChange:e=>{e&&D(a=>({...a,[l]:{...s,value:e.value}}))}}):(null==s?void 0:s.fieldType)===x.CHECKBOX?e.jsx(t,{size:"sm",className:"w-full",options:_,value:_.find(e=>e.value===s.value),onChange:e=>{e&&D(a=>({...a,[l]:{...s,value:e.value}}))}}):e.jsx(c,{value:(null==s?void 0:s.value)||"",onChange:e=>D(a=>({...a,[l]:{...s,value:e.target.value}})),size:"sm",className:"w-full"}):u[l].fieldType===x.DATE?e.jsx(t,{size:"sm",className:"w-full",value:N.find(e=>e.value===u[l].value),isDisabled:!0}):u[l].fieldType===x.CHECKBOX?e.jsx(t,{size:"sm",className:"w-full",value:_.find(e=>e.value===u[l].value),isDisabled:!0}):e.jsx(c,{value:u[l].value,readOnly:!0,size:"sm",className:"w-full"})}),e.jsx("div",{className:"flex-1",children:a?e.jsx(t,{size:"sm",className:"w-full",options:p,value:p.find(e=>e.value===(null==s?void 0:s.whenToWrite)),onChange:e=>{e&&D(a=>({...a,[l]:{...s,whenToWrite:e.value}}))}}):e.jsx(t,{size:"sm",className:"w-full",value:p.find(e=>e.value===u[l].whenToWrite),isDisabled:!0})}),e.jsx("div",{className:"flex w-20 justify-center gap-1",children:a?e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",StartIcon:"check",variant:"icon",color:"primary",onClick:()=>(e=>{const l=A[e];if(!l)return;if(!l.field.trim())return void r("Field name cannot be empty","error");if(l.field!==e&&Object.keys(u).includes(l.field.trim()))return void r("Field already exists","error");const a={...u};l.field!==e&&delete a[e],a[l.field.trim()]={fieldType:l.fieldType,value:l.value,whenToWrite:l.whenToWrite},m(a),W(e)})(l)}),e.jsx(d,{size:"sm",StartIcon:"x",variant:"icon",color:"secondary",onClick:()=>W(l)})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",StartIcon:"pencil",variant:"icon",color:"minimal",onClick:()=>(e=>{Object.keys(E).forEach(l=>{E[l]&&l!==e&&W(l)}),F(l=>({...l,[e]:!0})),D(l=>({...l,[e]:{field:e,fieldType:u[e].fieldType,value:u[e].value,whenToWrite:u[e].whenToWrite}}))})(l)}),e.jsx(d,{size:"sm",StartIcon:"x",variant:"icon",color:"minimal",onClick:()=>{const e={...u};delete e[l],m(e)}})]})})]},l)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(c,{size:"sm",className:"w-full",value:R.field,onChange:e=>I({...R,field:e.target.value})})}),e.jsx("div",{className:"flex-1",children:e.jsx(t,{size:"sm",className:"w-full",options:j,value:g,onChange:e=>{e&&(S(e),I({...R,fieldType:e.value,...e.value===x.DATE&&{value:k.value},...e.value===x.CHECKBOX&&{value:T.value}}))}})}),e.jsx("div",{className:"flex-1",children:R.fieldType===x.DATE?e.jsx(t,{size:"sm",className:"w-full",options:N,value:k,onChange:e=>{e&&(w(e),I({...R,value:e.value}))}}):R.fieldType===x.CHECKBOX?e.jsx(t,{size:"sm",className:"w-full",options:_,value:T,onChange:e=>{e&&(O(e),I({...R,value:e.value}))}}):e.jsx(c,{size:"sm",className:"w-full",value:R.value,onChange:e=>I({...R,value:e.target.value})})}),e.jsx("div",{className:"flex-1",children:e.jsx(t,{size:"sm",className:"w-full",options:p,value:z,onChange:e=>{e&&(y(e),I({...R,whenToWrite:e.value}))}})}),e.jsx("div",{className:"w-20"})]})]}),e.jsx(d,{className:"text-subtle mt-2 w-fit",StartIcon:"plus",color:"minimal",size:"sm",disabled:!(R.field&&R.fieldType&&""!==R.value&&R.whenToWrite),onClick:()=>{Object.keys(u).includes(R.field.trim())?r("Field already exists","error"):(m({...u,[R.field.trim()]:{fieldType:R.fieldType,value:R.value,whenToWrite:R.whenToWrite}}),I({field:"",fieldType:j[0].value,value:"",whenToWrite:p[0].value}))},children:v("add_new_field")})]}):null]})},k=function({app:x,eventType:h,onAppInstallSuccess:f}){var j;const k=l.usePathname(),{getAppData:w,setAppData:T,disabled:O}=a(),{enabled:z,updateEnabled:y}=_(x),E=w("roundRobinLeadSkip"),F=w("roundRobinSkipCheckRecordOn")??s.CONTACT,A=w("ifFreeEmailDomainSkipOwnerCheck")??!1,D=w("skipContactCreation"),R=w("createLeadIfAccountNull"),I=w("createNewContactUnderAccount"),W=w("createEventOn")??s.CONTACT,B=w("onBookingWriteToEventObject")??!1,L=w("onBookingWriteToEventObjectMap")??{},H=w("createEventOnLeadCheckForContact")??!1,K=w("onBookingChangeRecordOwner")??!1,G=w("onBookingChangeRecordOwnerName")??[],U=w("sendNoShowAttendeeData")??!1,X=w("sendNoShowAttendeeDataField")??"",M=w("onBookingWriteToRecord")??!1,P=w("onBookingWriteToRecordFields")??{},Y=w("ignoreGuests")??!1,$=w("roundRobinSkipFallbackToLeadOwner")??!1,Q=w("onCancelWriteToEventRecord")??!1,V=w("onCancelWriteToEventRecordFields")??{},J=w("rrSkipFieldRules")??[],{t:q}=n(),Z=[{label:q("contact"),value:s.CONTACT},{label:q("salesforce_lead"),value:s.LEAD},{label:q("salesforce_contact_under_account"),value:s.ACCOUNT}],[ee,le]=b.useState(Z.find(e=>e.value===W)??Z[0]),ae=[{label:q("contact"),value:s.CONTACT},{label:q("salesforce_lead"),value:s.LEAD},{label:q("account"),value:s.ACCOUNT}],[se,ne]=b.useState(ae.find(e=>e.value===F)??ae[0]),[ie,te]=b.useState({field:"",value:""}),oe=()=>e.jsx(C.SubSection,{children:e.jsx(C.SubSectionHeader,{icon:"at-sign",title:q("salesforce_create_new_contact_under_account"),labelFor:"create-new-contact-under-account",children:e.jsx(o,{size:"sm",labelOnLeading:!0,checked:I,onCheckedChange:e=>{T("createNewContactUnderAccount",e)}})})});return e.jsx(p,{onAppInstallSuccess:f,returnTo:`${i}${k}?tabName=apps`,app:x,teamId:(null==(j=h.team)?void 0:j.id)||void 0,switchOnClick:e=>{y(e)},switchChecked:z,hideSettingsIcon:!0,children:e.jsxs(C.Content,{children:[e.jsx(C.SubSection,{children:e.jsx(C.SubSectionHeader,{icon:"zap",title:q("salesforce_add_attendees_as"),justify:"start",labelFor:"add-attendees-as",children:e.jsx(t,{size:"sm",id:"add-attendees-as",className:"w-[200px]",options:Z,value:ee,onChange:e=>{e&&(le(e),T("createEventOn",e.value))}})})}),e.jsx(C.SubSection,{children:e.jsx(C.SubSectionHeader,{icon:"user-plus",title:q("salesforce_ignore_guests"),labelFor:"ignore-guests",children:e.jsx(o,{size:"sm",labelOnLeading:!0,checked:Y,onCheckedChange:e=>{T("ignoreGuests",e)}})})}),ee.value===s.CONTACT?e.jsx(C.SubSection,{children:e.jsx(C.SubSectionHeader,{icon:"user-plus",title:q("skip_contact_creation",{appName:"Salesforce"}),labelFor:"skip-contact-creation",children:e.jsx(o,{size:"sm",labelOnLeading:!0,checked:D,onCheckedChange:e=>{T("skipContactCreation",e)}})})}):null,ee.value===s.LEAD?e.jsxs(e.Fragment,{children:[e.jsx(C.SubSection,{children:e.jsx(C.SubSectionHeader,{icon:"user-plus",title:q("salesforce_create_event_on_contact"),labelFor:"create-event-on-contact",children:e.jsx(o,{size:"sm",labelOnLeading:!0,checked:H,onCheckedChange:e=>{T("createEventOnLeadCheckForContact",e)}})})}),e.jsx(oe,{})]}):null,ee.value===s.ACCOUNT?e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsx(C.SubSection,{children:e.jsx(C.SubSectionHeader,{icon:"user-plus",title:q("salesforce_if_account_does_not_exist"),labelFor:"create-lead-if-account-null",children:e.jsx(o,{size:"sm",labelOnLeading:!0,checked:R,onCheckedChange:e=>{T("createLeadIfAccountNull",e)}})})})]}):null,e.jsxs(C.SubSection,{children:[e.jsx(C.SubSectionHeader,{icon:"badge-check",title:q("on_booking_write_to_event_object"),children:e.jsx(o,{size:"sm",labelOnLeading:!0,checked:B,onCheckedChange:e=>{T("onBookingWriteToEventObject",e)}})}),B?e.jsxs(C.SubSectionContent,{children:[e.jsxs("div",{className:"text-subtle flex gap-3 px-3 py-[6px] text-sm font-medium",children:[e.jsx("div",{className:"flex-1",children:q("field_name")}),e.jsx("div",{className:"flex-1",children:q("value")}),e.jsx("div",{className:"w-10"})]}),e.jsxs(C.SubSectionNested,{children:[Object.keys(L).map(l=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(c,{value:l,readOnly:!0,size:"sm",className:"w-full"})}),e.jsx("div",{className:"flex-1",children:e.jsx(c,{value:L[l],readOnly:!0,size:"sm",className:"w-full"})}),e.jsx("div",{className:"flex w-10 justify-center",children:e.jsx(d,{StartIcon:"x",variant:"icon",size:"sm",color:"minimal",onClick:()=>{const e=L;delete L[l],T("onBookingWriteToEventObjectMap",e)}})})]},l)),e.jsxs("div",{className:"mt-2 flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(c,{size:"sm",className:"w-full",value:ie.field,onChange:e=>te({...ie,field:e.target.value})})}),e.jsx("div",{className:"flex-1",children:e.jsx(c,{size:"sm",className:"w-full",value:ie.value,onChange:e=>te({...ie,value:e.target.value})})}),e.jsx("div",{className:"w-10"})]})]}),e.jsx(d,{className:"text-subtle mt-2 w-fit",size:"sm",color:"secondary",disabled:!(ie.field&&ie.value),onClick:()=>{Object.keys(L).includes(ie.field.trim())?r("Field already exists","error"):(T("onBookingWriteToEventObjectMap",{...L,[ie.field.trim()]:ie.value.trim()}),te({field:"",value:""}))},children:q("add_new_field")})]}):null]}),e.jsx(C.SubSection,{children:e.jsx(S,{bookingAction:g.ON_BOOKING,optionLabel:q("salesforce_on_booking_write_to_record",{record:W}),optionEnabled:M,writeToObjectData:P,optionSwitchOnChange:e=>{T("onBookingWriteToRecord",e)},updateWriteToObjectData:e=>T("onBookingWriteToRecordFields",e)})}),e.jsxs(C.SubSection,{children:[e.jsx(C.SubSectionHeader,{icon:"user-plus",title:q("salesforce_change_record_owner_on_booking"),labelFor:"change-record-owner-on-booking",children:e.jsx(o,{size:"sm",labelOnLeading:!0,checked:K,onCheckedChange:e=>{T("onBookingChangeRecordOwner",e)}})}),K?e.jsx(C.SubSectionContent,{classNames:{container:"p-3"},children:e.jsxs("div",{children:[e.jsx(u,{htmlFor:"on-booking-change-record-owner-name",className:"text-subtle text-sm font-medium",children:q("salesforce_owner_name_to_change")}),e.jsx(c,{id:"on-booking-change-record-owner-name",size:"sm",value:G,onChange:e=>T("onBookingChangeRecordOwnerName",e.target.value)})]})}):null]}),h.schedulingType===m.ROUND_ROBIN?e.jsxs(e.Fragment,{children:[e.jsxs(C.SubSection,{children:[e.jsx(C.SubSectionHeader,{icon:"users",title:q("salesforce_book_directly_with_attendee_owner"),labelFor:"book-directly-with-attendee-owner",children:e.jsx(o,{size:"sm",id:"book-directly-witha-attendee-owner",checked:E,onCheckedChange:e=>{T("roundRobinLeadSkip",e),e&&T("enabled",e)}})}),E?e.jsx(C.SubSectionContent,{classNames:{container:"p-3"},children:e.jsxs("div",{children:[e.jsx(u,{htmlFor:"round-robin-skip-check-record-on",className:"text-subtle text-sm font-medium",children:q("salesforce_check_owner_of")}),e.jsx(t,{size:"sm",className:"w-60",options:ae,value:se,onChange:e=>{e&&(ne(e),T("roundRobinSkipCheckRecordOn",e.value))}})]})}):null]}),e.jsx(e.Fragment,{children:E?e.jsxs(e.Fragment,{children:[se.value===s.CONTACT?e.jsx(C.SubSection,{children:e.jsx(C.SubSectionHeader,{icon:"users",title:q("salesforce_round_robin_skip_fallback_to_lead_owner"),labelFor:"round-robin-skip-fallback-to-lead-owner",children:e.jsx(o,{id:"round-robin-skip-fallback-to-lead-owner",size:"sm",checked:$,onCheckedChange:e=>{T("roundRobinSkipFallbackToLeadOwner",e)}})})}):null,e.jsxs(C.SubSection,{children:[e.jsx(C.SubSectionHeader,{icon:"users",title:q("salesforce_if_free_email_domain_skip_owner_check"),labelFor:"if-free-email-domain-skip-owner-check",children:e.jsx(o,{id:"if-free-email-domain-skip-owner-check",size:"sm",checked:A,onCheckedChange:e=>{T("ifFreeEmailDomainSkipOwnerCheck",e)}})}),e.jsx(v,{severity:"info",title:q("skip_rr_description")})]}),e.jsx(N,{fieldRules:J,updateFieldRules:e=>T("rrSkipFieldRules",e)})]}):null})]}):null,e.jsx(C.SubSection,{children:e.jsx(S,{bookingAction:g.ON_CANCEL,optionLabel:q("salesforce_on_cancel_write_to_event"),optionEnabled:Q,writeToObjectData:V,optionSwitchOnChange:e=>{T("onCancelWriteToEventRecord",e)},updateWriteToObjectData:e=>T("onCancelWriteToEventRecordFields",e)})}),e.jsxs(C.SubSection,{children:[e.jsx(C.SubSectionHeader,{icon:"calendar",title:"Send no show attendee data to event object",labelFor:"send-no-show-attendee-data",children:e.jsx(o,{id:"send-no-show-attendee-data",size:"sm",checked:U,onCheckedChange:e=>{T("sendNoShowAttendeeData",e)}})}),U?e.jsxs(C.SubSectionContent,{classNames:{container:"p-3"},children:[e.jsx(u,{htmlFor:"send-no-show-attendee-data-field-name",className:"text-subtle text-sm font-medium",children:"Field name to check (must be checkbox data type)"}),e.jsx(c,{id:"send-no-show-attendee-data-field-name",size:"sm",value:X,onChange:e=>T("sendNoShowAttendeeDataField",e.target.value)})]}):null]})]})})};export{k as default};
