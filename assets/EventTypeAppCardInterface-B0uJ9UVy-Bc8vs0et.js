import{j as e}from"./vendor-motion-C-S6sOG7.js";import{Z as l,h as a}from"./AppCard-CQEg94Y3-PtHByE43.js";import{r as i}from"./vendor-react-HserkeQh.js";import{o as s,J as n,p as t,G as o,z as r,_ as c,$ as d,a0 as u,C as m,a1 as v,I as p,w as h,s as f,a2 as x}from"./index-S7FKDcGU-BFqPyMS1.js";import{f as j}from"./useIsAppEnabled-DnQeiNdg-Dsb_D8UK.js";import"./index-DXp2A_ku.js";var _=(e=>(e.ON_BOOKING="on_booking",e.ON_CANCEL="on_cancel",e))(_||{});const T=d.DATE,b=d.CHECKBOX,w={[d.TEXT]:"text",[d.STRING]:"text",[d.DATE]:"date",[d.DATETIME]:"datetime",[d.PHONE]:"phone",[d.CHECKBOX]:"checkbox",[d.PICKLIST]:"picklist",[d.CUSTOM]:"custom",[d.TEXTAREA]:"textarea"},g={[x.BOOKING_CANCEL_DATE]:"booking_cancel_date",[x.BOOKING_START_DATE]:"booking_start_date",[x.BOOKING_CREATED_DATE]:"booking_created_date"},C=(e,l,a)=>{const i=(e=>({[c.EVERY_BOOKING]:e===_.ON_CANCEL?"salesforce_on_every_cancellation":"on_every_booking",[c.FIELD_EMPTY]:"only_if_field_is_empty"}))(l);return e.map(e=>({label:a(i[e]),value:e}))},N=({bookingAction:l,optionLabel:s,optionEnabled:t,optionSwitchOnChange:o,writeToObjectData:d,updateWriteToObjectData:u,supportedFieldTypes:m,supportedDateFields:j,supportedWriteTriggers:N=[c.EVERY_BOOKING,c.FIELD_EMPTY]})=>{const{t:O}=n(),S=i.useMemo(()=>((e,l)=>e.map(e=>({label:l(w[e]),value:e})))(m,O),[m,O]),k=i.useMemo(()=>((e,l,a)=>{const i=e===_.ON_CANCEL?[x.BOOKING_CANCEL_DATE,x.BOOKING_START_DATE,x.BOOKING_CREATED_DATE]:[x.BOOKING_START_DATE,x.BOOKING_CREATED_DATE];return(l??i).map(e=>({label:a(g[e]),value:e}))})(l,j,O),[j,l,O]),E=i.useMemo(()=>C(N,l,O),[N,l,O]),y=E.length>1,z=i.useMemo(()=>(e=>[{label:e("true"),value:!0},{label:e("false"),value:!1}])(O),[O]),[A,D]=i.useState(S[0]),[I,B]=i.useState(k[0]),[F,W]=i.useState(z[0]),[G,K]=i.useState(E[0]),[L,R]=i.useState({}),[H,M]=i.useState({}),[P,X]=i.useState({field:"",fieldType:A.value,value:"",whenToWrite:G.value}),Y=e=>{R(l=>({...l,[e]:!1})),M(l=>{const a={...l};return delete a[e],a})};return e.jsxs(e.Fragment,{children:[e.jsx(a.SubSectionHeader,{icon:"star",labelFor:"write-to-object-settings",title:s,children:e.jsx(r,{checked:t,onCheckedChange:o,id:"write-to-object-settings",size:"sm"})}),t?e.jsxs(a.SubSectionContent,{children:[e.jsxs("div",{className:"text-subtle flex gap-3 px-3 py-[6px] text-sm font-medium",children:[e.jsx("div",{className:"flex-1",children:O("field_name")}),e.jsx("div",{className:"flex-1",children:O("field_type")}),e.jsx("div",{className:"flex-1",children:O("value")}),y&&e.jsx("div",{className:"flex-1",children:O("when_to_write")}),e.jsx("div",{className:"w-20"})]}),e.jsxs(a.SubSectionNested,{children:[Object.keys(d).map(l=>{const a=L[l],i=H[l];return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:a?e.jsx(v,{value:(null==i?void 0:i.field)||l,onChange:e=>M(a=>({...a,[l]:{...i,field:e.target.value}})),size:"sm",className:"w-full"}):e.jsx(v,{value:l,readOnly:!0,size:"sm",className:"w-full"})}),e.jsx("div",{className:"flex-1",children:a?e.jsx(p,{size:"sm",className:"w-full",options:S,value:S.find(e=>e.value===(null==i?void 0:i.fieldType)),onChange:e=>{e&&M(a=>({...a,[l]:{...i,fieldType:e.value,...e.value===T&&{value:k[0].value},...e.value===b&&{value:z[0].value}}}))}}):e.jsx(p,{size:"sm",className:"w-full",value:S.find(e=>e.value===d[l].fieldType),isDisabled:!0})}),e.jsx("div",{className:"flex-1",children:a?(null==i?void 0:i.fieldType)===T?e.jsx(p,{size:"sm",className:"w-full",options:k,value:k.find(e=>e.value===i.value),onChange:e=>{e&&M(a=>({...a,[l]:{...i,value:e.value}}))}}):(null==i?void 0:i.fieldType)===b?e.jsx(p,{size:"sm",className:"w-full",options:z,value:z.find(e=>e.value===i.value),onChange:e=>{e&&M(a=>({...a,[l]:{...i,value:e.value}}))}}):e.jsx(v,{value:(null==i?void 0:i.value)||"",onChange:e=>M(a=>({...a,[l]:{...i,value:e.target.value}})),size:"sm",className:"w-full"}):d[l].fieldType===T?e.jsx(p,{size:"sm",className:"w-full",value:k.find(e=>e.value===d[l].value),isDisabled:!0}):d[l].fieldType===b?e.jsx(p,{size:"sm",className:"w-full",value:z.find(e=>e.value===d[l].value),isDisabled:!0}):e.jsx(v,{value:d[l].value,readOnly:!0,size:"sm",className:"w-full"})}),y&&e.jsx("div",{className:"flex-1",children:a?e.jsx(p,{size:"sm",className:"w-full",options:E,value:E.find(e=>e.value===(null==i?void 0:i.whenToWrite)),onChange:e=>{e&&M(a=>({...a,[l]:{...i,whenToWrite:e.value}}))}}):e.jsx(p,{size:"sm",className:"w-full",value:E.find(e=>e.value===d[l].whenToWrite),isDisabled:!0})}),e.jsx("div",{className:"flex w-20 justify-center gap-1",children:a?e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"sm",StartIcon:"check",variant:"icon",color:"primary",onClick:()=>(e=>{const l=H[e];if(!l)return;if(!l.field.trim())return void f(O("field_name_cannot_be_empty"),"error");if(l.field!==e&&Object.keys(d).includes(l.field.trim()))return void f(O("field_already_exists"),"error");const a={...d};l.field!==e&&delete a[e],a[l.field.trim()]={fieldType:l.fieldType,value:l.value,whenToWrite:l.whenToWrite},u(a),Y(e)})(l)}),e.jsx(h,{size:"sm",StartIcon:"x",variant:"icon",color:"secondary",onClick:()=>Y(l)})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"sm",StartIcon:"pencil",variant:"icon",color:"minimal",onClick:()=>(e=>{Object.keys(L).forEach(l=>{L[l]&&l!==e&&Y(l)}),R(l=>({...l,[e]:!0})),M(l=>({...l,[e]:{field:e,fieldType:d[e].fieldType,value:d[e].value,whenToWrite:d[e].whenToWrite}}))})(l)}),e.jsx(h,{size:"sm",StartIcon:"x",variant:"icon",color:"minimal",onClick:()=>{const e={...d};delete e[l],u(e)}})]})})]},l)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(v,{size:"sm",className:"w-full",value:P.field,onChange:e=>X({...P,field:e.target.value})})}),e.jsx("div",{className:"flex-1",children:e.jsx(p,{size:"sm",className:"w-full",options:S,value:A,onChange:e=>{e&&(D(e),X({...P,fieldType:e.value,...e.value===T&&{value:I.value},...e.value===b&&{value:F.value}}))}})}),e.jsx("div",{className:"flex-1",children:P.fieldType===T?e.jsx(p,{size:"sm",className:"w-full",options:k,value:I,onChange:e=>{e&&(B(e),X({...P,value:e.value}))}}):P.fieldType===b?e.jsx(p,{size:"sm",className:"w-full",options:z,value:F,onChange:e=>{e&&(W(e),X({...P,value:e.value}))}}):e.jsx(v,{size:"sm",className:"w-full",value:P.value,onChange:e=>X({...P,value:e.target.value})})}),y&&e.jsx("div",{className:"flex-1",children:e.jsx(p,{size:"sm",className:"w-full",options:E,value:G,onChange:e=>{e&&(K(e),X({...P,whenToWrite:e.value}))}})}),e.jsx("div",{className:"w-20"})]})]}),e.jsx(h,{className:"text-subtle mt-2 w-fit",StartIcon:"plus",color:"minimal",size:"sm",disabled:!(P.field&&P.fieldType&&""!==P.value&&P.whenToWrite),onClick:()=>{Object.keys(d).includes(P.field.trim())?f(O("field_already_exists"),"error"):(u({...d,[P.field.trim()]:{fieldType:P.fieldType,value:P.value,whenToWrite:P.whenToWrite}}),X({field:"",fieldType:S[0].value,value:"",whenToWrite:E[0].value}))},children:O("add_new_field")})]}):null]})},O=function({app:i,eventType:v,onAppInstallSuccess:p}){var h;const f=s.usePathname(),{t:x}=n(),{getAppData:T,setAppData:b}=t(),{enabled:w,updateEnabled:g}=j(i),C=T("ignoreGuests")??!1,O=T("skipContactCreation")??!1,S=T("setOrganizerAsOwner")??!1,k=T("overwriteContactOwner")??!1,E=T("onBookingWriteToEventObject")??!1,y=T("onBookingWriteToEventObjectFields")??{},z=T("roundRobinLeadSkip")??!1,A=T("ifFreeEmailDomainSkipOwnerCheck")??!1;return e.jsx(l,{onAppInstallSuccess:p,returnTo:`${o}${f}?tabName=apps`,app:i,teamId:(null==(h=v.team)?void 0:h.id)||void 0,switchOnClick:e=>{g(e)},switchChecked:w,hideSettingsIcon:!0,children:e.jsxs(a.Content,{children:[e.jsx(a.SubSection,{children:e.jsx(a.SubSectionHeader,{icon:"user-plus",title:x("hubspot_ignore_guests"),labelFor:"ignore-guests",children:e.jsx(r,{size:"sm",labelOnLeading:!0,checked:C,onCheckedChange:e=>{b("ignoreGuests",e)}})})}),e.jsx(a.SubSection,{children:e.jsx(a.SubSectionHeader,{icon:"user-plus",title:x("skip_contact_creation",{appName:"HubSpot"}),labelFor:"skip-contact-creation",children:e.jsx(r,{size:"sm",labelOnLeading:!0,checked:O,onCheckedChange:e=>{b("skipContactCreation",e)}})})}),e.jsx(a.SubSection,{children:e.jsx(a.SubSectionHeader,{icon:"user-check",title:x("set_organizer_as_contact_owner"),labelFor:"set-organizer-as-owner",children:e.jsx(r,{size:"sm",labelOnLeading:!0,checked:S,onCheckedChange:e=>{b("setOrganizerAsOwner",e),e||b("overwriteContactOwner",!1)}})})}),S&&e.jsx(a.SubSection,{children:e.jsx(a.SubSectionHeader,{icon:"refresh-cw",title:x("overwrite_existing_contact_owner"),labelFor:"overwrite-contact-owner",children:e.jsx(r,{size:"sm",labelOnLeading:!0,checked:k,onCheckedChange:e=>{b("overwriteContactOwner",e)}})})}),e.jsx(a.SubSection,{children:e.jsx(N,{bookingAction:_.ON_BOOKING,optionLabel:x("on_booking_write_to_event_object"),optionEnabled:E,writeToObjectData:y,optionSwitchOnChange:e=>{b("onBookingWriteToEventObject",e)},updateWriteToObjectData:e=>b("onBookingWriteToEventObjectFields",e),supportedFieldTypes:[d.TEXT,d.DATE,d.PHONE,d.CHECKBOX,d.CUSTOM],supportedWriteTriggers:[c.EVERY_BOOKING]})}),v.schedulingType===u.ROUND_ROBIN?e.jsxs(e.Fragment,{children:[e.jsx(a.SubSection,{children:e.jsx(a.SubSectionHeader,{icon:"users",title:x("crm_book_directly_with_attendee_owner",{appName:i.name}),labelFor:"book-directly-with-attendee-owner",children:e.jsx(r,{size:"sm",id:"book-directly-with-attendee-owner",checked:z,onCheckedChange:e=>{b("roundRobinLeadSkip",e),e&&b("enabled",e)}})})}),z&&e.jsxs(a.SubSection,{children:[e.jsx(a.SubSectionHeader,{icon:"users",title:x("crm_if_free_email_domain_skip_owner_check"),labelFor:"if-free-email-domain-skip-owner-check",children:e.jsx(r,{size:"sm",id:"if-free-email-domain-skip-owner-check",checked:A,onCheckedChange:e=>{b("ifFreeEmailDomainSkipOwnerCheck",e)}})}),e.jsx(m,{severity:"info",title:x("skip_rr_description")})]})]}):null]})})};export{O as default};
